!function e(t,n,a){function i(s,o){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!o&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n?n:e)},u,u.exports,e,t,n,a)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}({"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\ajax.js":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("es6-promise").Promise;n.get=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=void 0;return new a(function(a,i){n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE)if(200==n.status)if(n.responseText)try{a(JSON.parse(n.responseText))}catch(e){console.error("Response text is not null, but it's not a valid JSON: "+n.responseText),a(null)}else a(null);else i({code:n.status,responseText:n.responseText})},n.withCredentials=t.withCredentials!==!1,n.open("GET",e,!0),n.send()})},n.post=function(e,t){return new a(function(n,a){var i=void 0;i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE)if(200==i.status)if(i.responseText)try{n(JSON.parse(i.responseText))}catch(e){console.error("Response text is not null, but it's not a valid JSON: "+i.responseText),n(null)}else n(null);else a({code:i.status,responseText:i.responseText})},i.withCredentials=!0,i.open("POST",e,!0),i.send(JSON.stringify(t))})}},{"es6-promise":"es6-promise"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\City.jsx":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e=Math.round(e),e>0?"+"+e:e}function r(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function s(e){switch(e){case"01d":return"B";case"02d":return"H";case"03d":return"N";case"04d":return"Y";case"09d":return"R";case"10d":return"Q";case"11d":return"P";case"13d":return"V";case"50d":return"M";case"01n":return"2";case"02n":return"4";case"03n":return"5";case"04n":return"%";case"09n":return"8";case"10n":return"7";case"11n":return"6";case"13n":return'"';case"50n":return"M";default:return")"}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("react"),c=a(o),l=e("strftime"),u=a(l);n["default"]=c["default"].createClass({displayName:"City",render:function(){var e=this.props,t=e.city,n=e.onRemove,a=e.displayMode;e.isDragging;console.log("City!",t);var o="city__temp";return t.weather.temp>0?o+=" city__temp--warm":t.weather.temp<0&&(o+=" city__temp--cold"),"full"===a?c["default"].createElement("div",{className:"city city--full"},c["default"].createElement("div",{className:"city__main-info"},c["default"].createElement("div",{className:"city__icon"},c["default"].createElement("i",{"aria-hidden":"true",className:"meteoicon",title:r(t.weather.desc.description)},s(t.weather.desc.icon))),c["default"].createElement("div",{className:"city__name"},t.name)),c["default"].createElement("div",{className:"city__details-row"},c["default"].createElement("div",{className:o},i(t.weather.temp)),c["default"].createElement("div",{className:"city__details"},c["default"].createElement("div",null,c["default"].createElement("span",{className:"city__aux-param"},"Pressure: ",t.weather.pressure," hPa"),c["default"].createElement("span",{className:"city__aux-param"},"Humidity: ",t.weather.humidity,"%"),c["default"].createElement("span",{className:"city__aux-param"},"Wind: ",t.weather.wind.speed," m/s (",t.weather.wind.deg,"Â°)")),c["default"].createElement("div",{className:"city__last-update"},"Last update: ",(0,u["default"])("%T %F",new Date(t.weather.dt))))),c["default"].createElement("div",{className:"city__controls"},c["default"].createElement("button",{onClick:n(t.name),tabIndex:"-1"},c["default"].createElement("i",{className:"icon fa fa-trash-o","aria-hidden":"true"})))):c["default"].createElement("div",{className:"city city--short"},c["default"].createElement("div",{className:"city__icon"},c["default"].createElement("i",{"aria-hidden":"true",className:"meteoicon",title:r(t.weather.desc.description)},s(t.weather.desc.icon))),c["default"].createElement("div",{className:"city__name"},t.name),c["default"].createElement("div",{className:o},i(t.weather.temp)),c["default"].createElement("div",{className:"city__controls"},c["default"].createElement("div",{className:"city__remove-button",rowSpan:"2"},c["default"].createElement("button",{onClick:n(t.name),tabIndex:"-1"},c["default"].createElement("i",{className:"icon fa fa-trash-o","aria-hidden":"true"})))))}})},{react:"react",strftime:"strftime"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\CityList.jsx":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),r=a(i),s=e("./City"),o=a(s),c=e("./DragableItem"),l=a(c);n["default"]=r["default"].createClass({displayName:"CityList",onRemove:function(e){var t=this;return function(){t.props.onRemove(e)}},render:function(){var e=this;return r["default"].createElement("div",{className:"city-list"},this.props.data.length>0?this.props.data.map(function(t,n){return r["default"].createElement(l["default"],{key:t.name,item:t,index:n,onSwap:e.props.onSwap},r["default"].createElement(o["default"],{city:t,onRemove:e.onRemove,displayMode:e.props.displayMode}))}):r["default"].createElement("div",{className:"city-list__empty"},"There are no cities added yet"))}})},{"./City":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\City.jsx","./DragableItem":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\DragableItem.jsx",react:"react"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\DragableItem.jsx":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),r=a(i),s=e("react-dom"),o=e("react-dnd"),c=e("strftime"),l=(a(c),e("react-dnd-html5-backend")),u="drag_types_city",d=r["default"].createClass({displayName:"component",componentDidMount:function(){this.props.connectDragPreview((0,l.getEmptyImage)(),{captureDraggingState:!0})},render:function(){var e=this.props,t=e.connectDragSource,n=e.connectDropTarget,a=e.isDragging,i="dragable-item";return a&&(i+=" dragable-item--dragging"),n(r["default"].createElement("div",{className:i},t(r["default"].createElement("div",{className:"dragable-item__holder"},r["default"].createElement("i",{className:"icon fa fa-th"}))),r["default"].createElement("div",{className:"dragable-item__body"},this.props.children)))}}),f={beginDrag:function(e,t,n){return{data:e.item,index:e.index}}},m=function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()}},h=(0,o.DragSource)(u,f,m)(d),p={hover:function(e,t,n){var a=t.getItem().index,i=e.index,r=(0,s.findDOMNode)(n).getBoundingClientRect(),o=r.bottom-r.height/2,c=t.getClientOffset().y;(a>i&&o>c||i>a&&c>o)&&(e.onSwap(a,i),t.getItem().index=i)},drop:function(e,t,n){console.log("on drop: not implemented")}},v=function(e,t){return{connectDropTarget:e.dropTarget()}},g=(0,o.DropTarget)(u,p,v)(h);n["default"]=g},{react:"react","react-dnd":"react-dnd","react-dnd-html5-backend":"react-dnd-html5-backend","react-dom":"react-dom",strftime:"strftime"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\DynamicSelect.js":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),r=a(i);n["default"]=r["default"].createClass({displayName:"DynamicSelect",getInitialState:function(){return{text:"",focused:!1,blurDisabled:!1,highlightedOption:null,optionList:[],waiting:!1}},onFocus:function(e){this.setState({focused:!0})},onBlur:function(e){this.state.blurDisabled||this.setState({focused:!1,text:"",optionList:[]})},onInput:function(e){var t=this,n=e.target.value;this.setState({text:n,highlightedOption:null,waiting:!0},function(){t.props.loadOptions(t.state.text).then(function(e){t.setState(function(t){if(t.text===n){var a=[];return e.forEach(function(e){0===a.filter(function(t){return e.value===t.value}).length&&a.push(e)}),{optionList:a}}return t})},function(e){t.setState(function(e){return e.text===n?{optionList:[]}:e})}).then(function(){t.setState({waiting:!1})})})},onSelect:function(e){var t=this;this.setState({text:"",optionList:[],blurDisabled:!1},function(){t.props.onChange(e)})},onMouseOverOptionList:function(){this.setState({blurDisabled:!0})},onMouseOutOptionList:function(){this.setState({blurDisabled:!1})},onMouseOverOption:function(e){this.setState({highlightedOption:e})},onMouseOutOption:function(){this.setState({highlightedOption:null})},onReset:function(){var e=this;this.setState({text:"",optionList:[]},function(){e.props.onReset&&e.props.onReset()})},onKeyDown:function(e){40===e.keyCode?(this.setState(function(e){var t=e.optionList,n=e.highlightedOption;if(0!==t.length){if(null===n)return{highlightedOption:t[0]};for(var a=0;a<t.length;++a)if(t[a].value===n.value)return a===t.length-1?{highlightedOption:t[0]}:{highlightedOption:t[a+1]}}return e}),e.preventDefault()):38===e.keyCode?(this.setState(function(e){var t=e.optionList,n=e.highlightedOption;if(0!==t.length){if(null===n)return{highlightedOption:t[0]};for(var a=0;a<t.length;++a)if(t[a].value===n.value)return 0===a?{highlightedOption:t[t.length-1]}:{highlightedOption:t[a-1]}}return e}),e.preventDefault()):13===e.keyCode?(null!==this.state.highlightedOption&&this.onSelect(this.state.highlightedOption),e.preventDefault()):9===e.keyCode?null!==this.state.highlightedOption&&this.onSelect(this.state.highlightedOption):27===e.keyCode&&(this.onReset(),e.preventDefault())},focus:function(){this.refs.inp.focus()},onOptionClick:function(e,t){var n=this;e.preventDefault(),this.setState({focused:!1,blurDisabled:!1},function(){n.onSelect(t)})},render:function(){var e=this,t="dynamic-select";this.state.focused&&(t+=" dynamic-select--focused");var n=this.props.value||{value:"",label:""};return r["default"].createElement("div",{className:t},r["default"].createElement("div",{className:"dynamic-select__pseudo-input"},r["default"].createElement("div",{className:"dynamic-select__icon"},this.state.waiting?r["default"].createElement("i",{className:"fa fa-spinner"}):r["default"].createElement("i",{className:"fa fa-search"})),r["default"].createElement("input",{tabIndex:this.props.tabIndex,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",id:this.props.id,className:"dynamic-select__input",type:"text",placeholder:this.state.focused||""!==this.state.text?"":this.props.placeholder,value:this.state.focused?this.state.text:n.label,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onInput,onClick:this.onClick,onKeyDown:this.onKeyDown,ref:"inp"}),r["default"].createElement("div",{className:"dynamic-select__icon",onClick:this.onReset},r["default"].createElement("i",{className:"fa fa-times"}))),r["default"].createElement("div",{className:"dynamic-select__option-list",onMouseOver:this.onMouseOverOptionList,onMouseOut:this.onMouseOutOptionList},0===this.state.optionList.length?r["default"].createElement("div",{className:"dynamic-select__option dynamic-select__option--nothing-found"},"Nothing found"):this.state.optionList.map(function(t){var n="dynamic-select__option";return null!==e.state.highlightedOption&&e.state.highlightedOption.value===t.value&&(n+=" dynamic-select__option--highlighted"),r["default"].createElement("div",{key:t.value,className:n,onMouseOver:function(n){return e.onMouseOverOption(t)},onMouseOut:function(t){return e.onMouseOutOption()},onClick:function(n){return e.onOptionClick(n,t)}},t.label)})))}})},{react:"react"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\NewCity.jsx":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),r=a(i),s=e("../data_access"),o=e("./DynamicSelect"),c=a(o);n["default"]=r["default"].createClass({displayName:"NewCity",onSubmit:function(e){return e.preventDefault(),this.onAdd(),!1},onAdd:function(){var e=this;this.setState({waiting:!0});var t=this.props.onAdd(this.state.selectValue.value);t.then(function(){e.setState({error:null})})["catch"](function(t){var n;n=404==t.code?"city have not found":500==t.code?"internal server error. Sorry :(":t.message,e.setState({error:"Unable to add city '"+t.city+"': "+n})}).then(function(){e.setState({selectValue:null,waiting:!1})})},getInitialState:function(){return{selectValue:null,waiting:!1,error:null}},loadOptions:function(e){return(0,s.fetchCityList)(e).then(function(e){return e.map(function(e){return{value:e.name,label:e.name}})})},onFinishSearch:function(e){var t=this;this.setState({selectValue:e},function(){t.onAdd()})},onSelectReset:function(){this.setState({selectValue:null})},render:function(){return r["default"].createElement("div",{className:"new-city"},r["default"].createElement("form",{onSubmit:this.onSubmit,className:"new-city__form"},r["default"].createElement("div",{className:"new-city__item"},r["default"].createElement("label",{htmlFor:"city"},r["default"].createElement("span",null,"Add city: "))),r["default"].createElement("div",{className:"new-city__item"},r["default"].createElement(c["default"],{id:"city",loadOptions:this.loadOptions,value:this.state.selectValue,onReset:this.onSelectReset,onChange:this.onFinishSearch,placeholder:"Begin writing city name",ref:"select",tabIndex:"1"})),r["default"].createElement("div",{className:"new-city__item new-city__item--empty",style:{display:this.state.waiting?"inherit":"none"}},r["default"].createElement("div",{className:"new-city__loader"},r["default"].createElement("i",{className:"dynamic-select__state-icon fa fa-spinner"})))),this.state.error?r["default"].createElement("div",{className:"error"},this.state.error):null)}})},{"../data_access":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\data_access.js","./DynamicSelect":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\DynamicSelect.js",react:"react"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\Root.jsx":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("react"),r=a(i),s=e("react-addons-update"),o=a(s),c=e("es6-promise"),l=e("react-dnd-html5-backend"),u=(a(l),e("react-dnd-touch-backend")),d=a(u),f=e("react-dnd"),m=e("./NewCity"),h=a(m),p=e("./CityList"),v=a(p),g=e("../data_access.js"),y=r["default"].createClass({displayName:"Root",getInitialState:function(){var e,t=this,n={initialized:!1,cityList:[],displayMode:"short"};localStorage.getItem("reactState");if(null!==localStorage.getItem("reactState"))try{e=JSON.parse(localStorage.getItem("reactState"))}catch(a){console.error("Unable to parse old state, use default"),e=n}else e=n;if(!e.initialized){var i=function(){t.setState(function(e){var n=(0,o["default"])(e,{initialized:{$set:!0}});return t.saveState(n),n})};setTimeout(i,12e3),(0,g.fetchCurrentCity)().then(function(e){return(0,g.fetchWeather)(e)}).then(function(e){t.setState(function(n){if(n.initialized)return n;var a;return a=(0,o["default"])(n,{cityList:{$push:[e]}}),t.saveState(a),a})})["catch"](function(e){console.error(e)}).then(function(){i()})}return this.saveState(e),e},saveState:function(e){e=e||this.state,localStorage.setItem("reactState",JSON.stringify(e))},componentDidMount:function(){var e=this,t=function n(){var t=e.state.cityList.map(function(e){return(0,g.fetchWeather)(e.name)});t.forEach(function(t){t.then(function(t){e.setState(function(e){var n=e.cityList.map(function(e){return e.name===t.name?t:e});return(0,o["default"])(e,{cityList:{$set:n}})})})["catch"](function(e){console.error(e)})}),t=t.map(function(e){return e["catch"](function(e){return c.Promise.resolve(e)})}),c.Promise.all(t).then(function(){e.saveState(),setTimeout(n,3e5)})};t()},onNewCity:function(e){var t=this,n=(0,g.fetchWeather)(e);return n.then(function(a){return t.setState(function(n){var i,r=0===n.cityList.filter(function(t){return t.name===e}).length;return i=r?(0,o["default"])(n,{cityList:{$push:[a]}}):n,t.saveState(i),i}),n})},onRemoveCity:function(e){var t=this;this.setState(function(n){var a=n.cityList.filter(function(t){return t.name!==e}),i=(0,o["default"])(n,{cityList:{$set:a}});return t.saveState(i),i})},onChangeDisplayMode:function(e,t){var n=this;this.setState(function(e){var t="full"===n.state.displayMode?"short":"full",a=(0,o["default"])(e,{displayMode:{$set:t}});return n.saveState(a),a})},onSwapCities:function(e,t){var n=this;this.setState(function(a){var i=a.cityList.slice(0),r=i[e];return i[e]=i[t],i[t]=r,n.saveState((0,o["default"])(a,{cityList:{$set:i}})),{cityList:i}})},render:function(){return r["default"].createElement("div",{className:"l-root"},r["default"].createElement("div",{className:"l-row "},r["default"].createElement("div",{className:"l-cell l-header"},this.state.initialized?null:r["default"].createElement("p",{className:"initializing-msg"},"Determining current city..."),r["default"].createElement(h["default"],{onAdd:this.onNewCity}))),r["default"].createElement("div",{className:"l-row"},r["default"].createElement("div",{className:"l-cell"},r["default"].createElement("div",{className:"l-content"},r["default"].createElement(v["default"],{data:this.state.cityList,displayMode:this.state.displayMode,onRemove:this.onRemoveCity,onSwap:this.onSwapCities})))),r["default"].createElement("div",{className:"l-row"},r["default"].createElement("div",{className:"l-cell l-footer"},r["default"].createElement("div",{className:"l-content"},r["default"].createElement("div",{className:"display-settings"},r["default"].createElement("label",null,r["default"].createElement("input",{type:"checkbox",checked:"full"===this.state.displayMode,onChange:this.onChangeDisplayMode,tabIndex:"-1"}),"show detailed information"))))))}});n["default"]=(0,f.DragDropContext)((0,d["default"])({enableMouseEvents:!0}))(y)},{"../data_access.js":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\data_access.js","./CityList":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\CityList.jsx","./NewCity":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\NewCity.jsx","es6-promise":"es6-promise",react:"react","react-addons-update":"react-addons-update","react-dnd":"react-dnd","react-dnd-html5-backend":"react-dnd-html5-backend","react-dnd-touch-backend":"react-dnd-touch-backend"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\data_access.js":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.fetchCityList=n.fetchCurrentCity=n.fetchWeather=void 0;var a=e("es6-promise"),i=e("./ajax");n.fetchWeather=function(e){return(0,i.get)(window.context.backend_url+"/weather?q="+e).then(function(t){return{name:e,weather:{temp:t.main.temp||0,pressure:t.main.pressure,humidity:t.main.humidity,dt:1e3*t.dt,wind:t.wind,desc:t.weather[0]}}},function(t){return a.Promise.reject({code:t.code,city:e,message:t.responseText})})},n.fetchCurrentCity=function(){var e=new a.Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){e(t)},function(e){t(e)})});return e.then(function(e){var t="DEBUG"===window.context.env?"http":"https",n=e.coords.latitude,a=e.coords.longitude,r=t+"://maps.googleapis.com/maps/api/geocode/json?latlng="+n+","+a+"&sensor=true&language=en";return(0,i.get)(r,{withCredentials:!1})}).then(function(e){if(!e.results.length>0)throw new Error("Google hasn't found anything");var t=e.results[0],n=t.address_components;if(n=n.filter(function(e){return-1!=e.types.indexOf("administrative_area_level_1")&&-1!=e.types.indexOf("political")}),!n.length>0)throw new Error("City component hasn't found");var a=n[0],i=a.long_name;return i})},n.fetchCityList=function(e){return(0,i.get)(window.context.backend_url+"/cities?q="+e)}},{"./ajax":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\ajax.js","es6-promise":"es6-promise"}],"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\main.js":[function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=e("react"),r=a(i),s=e("react-dom"),o=a(s),c=e("./components/Root"),l=a(c);"PROD"===window.context.env&&"http:"===window.location.protocol&&(window.location.href=window.location.href.replace(/^http/,"https")),document.addEventListener("keydown",function(e){if(9===e.keyCode){var t=Array.prototype.slice.call(document.querySelectorAll("input, button, textarea"));if(t=t.filter(function(e){return"input"===e.nodeName.toLowerCase()&&"hidden"===e.getAttribute("type")?!1:e.tabIndex>0&&!e.disabled}),t.length>0){t=t.sort(function(e,t){return e.tabIndex-t.tabIndex});for(var n=0;n<t.length;++n)if(t[n]===document.activeElement){n==t.length-1?t[0].focus():t[n+1].focus();break}}return e.preventDefault(),!1}}),document.addEventListener("DOMContentLoaded",function(){o["default"].render(r["default"].createElement(l["default"],null),document.getElementById("react"))})},{"./components/Root":"C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\components\\Root.jsx",react:"react","react-dom":"react-dom"}]},{},["C:\\Users\\Nikolai_Mavrenkov@epam.com\\training\\weethr\\frontend\\scripts\\main.js"]);